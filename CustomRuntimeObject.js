var gdjs;(function(l){class f extends l.RuntimeObject{constructor(t,e){super(t,e);this._isUntransformedHitBoxesDirty=!0;this._untransformedHitBoxes=[];this._unrotatedAABB={min:[0,0],max:[0,0]};this._scaleX=1;this._scaleY=1;this._flippedX=!1;this._flippedY=!1;this.opacity=255;this._instanceContainer=new l.CustomRuntimeObjectInstanceContainer(t,this),this._instanceContainer.loadFrom(e),this.getRenderer().reinitialize(this,t)}reinitialize(t){super.reinitialize(t),this._instanceContainer.loadFrom(t),this.getRenderer().reinitialize(this,this.getParent()),this.onCreated()}updateFromObjectData(t,e){return this._instanceContainer.updateFrom(t,e)}extraInitializationFromInitialInstance(t){t.customSize&&(this.setWidth(t.width),this.setHeight(t.height))}onDestroyFromScene(t){this.onDestroy(t),super.onDestroyFromScene(t),this._instanceContainer.onDestroyFromScene(t)}update(t){this._instanceContainer._updateObjectsPreEvents(),this.doStepPreEvents(t);const e=this.getRuntimeScene().getProfiler();e&&e.begin(this.type),this.doStepPostEvents(t),e&&e.end(this.type),this._instanceContainer._updateObjectsPostEvents()}onHotReloading(t){}doStepPreEvents(t){}doStepPostEvents(t){}onDestroy(t){}updatePreRender(t){this._instanceContainer._updateObjectsPreRender(),this.getRenderer().ensureUpToDate()}getRendererObject(){return this.getRenderer().getRendererObject()}getRenderer(){return this._instanceContainer.getRenderer()}onChildrenLocationChanged(){this._isUntransformedHitBoxesDirty=!0,this.invalidateHitboxes(),this.getRenderer().update()}updateHitBoxes(){this._isUntransformedHitBoxesDirty&&this._updateUntransformedHitBoxes();for(let t=0;t<this._untransformedHitBoxes.length;++t){t>=this.hitBoxes.length&&this.hitBoxes.push(new l.Polygon);for(let e=0;e<this._untransformedHitBoxes[t].vertices.length;++e)e>=this.hitBoxes[t].vertices.length&&this.hitBoxes[t].vertices.push([0,0]),this.applyObjectTransformation(this._untransformedHitBoxes[t].vertices[e][0],this._untransformedHitBoxes[t].vertices[e][1],this.hitBoxes[t].vertices[e]);this.hitBoxes[t].vertices.length=this._untransformedHitBoxes[t].vertices.length}}_updateUntransformedHitBoxes(){this._isUntransformedHitBoxesDirty=!1;const t=this._unrotatedAABB.min[0],e=this._unrotatedAABB.min[1],s=this._unrotatedAABB.max[0],n=this._unrotatedAABB.max[1];if(this._untransformedHitBoxes.length=0,this._instanceContainer.getAdhocListOfAllInstances().length===0)this._unrotatedAABB.min[0]=0,this._unrotatedAABB.min[1]=0,this._unrotatedAABB.max[0]=0,this._unrotatedAABB.max[1]=0;else{let i=Number.MAX_VALUE,a=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=-Number.MAX_VALUE;for(const d of this._instanceContainer.getAdhocListOfAllInstances()){Array.prototype.push.apply(this._untransformedHitBoxes,d.getHitBoxes());const h=d.getAABB();i=Math.min(i,h.min[0]),a=Math.min(a,h.min[1]),o=Math.max(o,h.max[0]),r=Math.max(r,h.max[1])}for(this._unrotatedAABB.min[0]=i,this._unrotatedAABB.min[1]=a,this._unrotatedAABB.max[0]=o,this._unrotatedAABB.max[1]=r;this.hitBoxes.length<this._untransformedHitBoxes.length;)this.hitBoxes.push(new l.Polygon);this.hitBoxes.length=this._untransformedHitBoxes.length}(this._unrotatedAABB.min[0]!==t||this._unrotatedAABB.min[1]!==e||this._unrotatedAABB.max[0]!==s||this._unrotatedAABB.max[1]!==n)&&this._instanceContainer.onObjectUnscaledCenterChanged((t+s)/2,(e+n)/2)}applyObjectTransformation(t,e,s){let n=this.getCenterX(),i=this.getCenterY();this._flippedX&&(t=t+(n-t)*2),this._flippedY&&(e=e+(i-e)*2);const a=Math.abs(this._scaleX),o=Math.abs(this._scaleY);t*=a,e*=o,n*=a,i*=o;const r=this.angle/180*Math.PI,d=Math.cos(r),h=Math.sin(r),u=t-n,c=e-i;t=n+d*u-h*c,e=i+h*u+d*c,s.length=2,s[0]=t+this.x,s[1]=e+this.y}applyObjectInverseTransformation(t,e,s){t-=this.getCenterXInScene(),e-=this.getCenterYInScene();const n=Math.abs(this._scaleX),i=Math.abs(this._scaleY),a=this.angle/180*Math.PI,o=Math.cos(-a),r=Math.sin(-a),d=t;t=o*t-r*e,e=r*d+o*e,t/=n,e/=i,this._flippedX&&(t=-t),this._flippedY&&(e=-e);const h=this.getUnscaledWidth()/2+this._unrotatedAABB.min[0],u=this.getUnscaledHeight()/2+this._unrotatedAABB.min[1];s[0]=t+h,s[1]=e+u}getDrawableX(){return this._isUntransformedHitBoxesDirty&&this._updateUntransformedHitBoxes(),this.x+this._unrotatedAABB.min[0]*this._scaleX}getDrawableY(){return this._isUntransformedHitBoxesDirty&&this._updateUntransformedHitBoxes(),this.y+this._unrotatedAABB.min[1]*this._scaleY}getUnscaledWidth(){return this._isUntransformedHitBoxesDirty&&this._updateUntransformedHitBoxes(),this._unrotatedAABB.max[0]-this._unrotatedAABB.min[0]}getUnscaledHeight(){return this._isUntransformedHitBoxesDirty&&this._updateUntransformedHitBoxes(),this._unrotatedAABB.max[1]-this._unrotatedAABB.min[1]}getUnscaledCenterX(){return this._isUntransformedHitBoxesDirty&&this._updateUntransformedHitBoxes(),(this._unrotatedAABB.min[0]+this._unrotatedAABB.max[0])/2}getUnscaledCenterY(){return this._isUntransformedHitBoxesDirty&&this._updateUntransformedHitBoxes(),(this._unrotatedAABB.min[1]+this._unrotatedAABB.max[1])/2}getWidth(){return this.getUnscaledWidth()*this.getScaleX()}getHeight(){return this.getUnscaledHeight()*this.getScaleY()}setWidth(t){const e=this.getUnscaledWidth();e!==0&&this.setScaleX(t/e)}setHeight(t){const e=this.getUnscaledHeight();e!==0&&this.setScaleY(t/e)}setSize(t,e){this.setWidth(t),this.setHeight(e)}setX(t){t!==this.x&&(this.x=t,this.invalidateHitboxes(),this.getRenderer().updateX())}setY(t){t!==this.y&&(this.y=t,this.invalidateHitboxes(),this.getRenderer().updateY())}setAngle(t){this.angle!==t&&(this.angle=t,this.invalidateHitboxes(),this.getRenderer().updateAngle())}setScale(t){t<0&&(t=0),!(t===Math.abs(this._scaleX)&&t===Math.abs(this._scaleY))&&(this._scaleX=t*(this._flippedX?-1:1),this._scaleY=t*(this._flippedY?-1:1),this.invalidateHitboxes(),this.getRenderer().update())}setScaleX(t){t<0&&(t=0),t!==Math.abs(this._scaleX)&&(this._scaleX=t*(this._flippedX?-1:1),this.invalidateHitboxes(),this.getRenderer().update())}setScaleY(t){t<0&&(t=0),t!==Math.abs(this._scaleY)&&(this._scaleY=t*(this._flippedY?-1:1),this.invalidateHitboxes(),this.getRenderer().update())}getScale(){return(Math.abs(this._scaleX)+Math.abs(this._scaleY))/2}getScaleY(){return Math.abs(this._scaleY)}getScaleX(){return Math.abs(this._scaleX)}setOpacity(t){t<0&&(t=0),t>255&&(t=255),this.opacity=t,this.getRenderer().updateOpacity()}getOpacity(){return this.opacity}hide(t){t===void 0&&(t=!0),this.hidden=t,this.getRenderer().updateVisibility()}flipX(t){t!==this._flippedX&&(this._scaleX*=-1,this._flippedX=t,this.invalidateHitboxes(),this.getRenderer().update())}flipY(t){t!==this._flippedY&&(this._scaleY*=-1,this._flippedY=t,this.invalidateHitboxes(),this.getRenderer().update())}isFlippedX(){return this._flippedX}isFlippedY(){return this._flippedY}}l.CustomRuntimeObject=f,f.supportsReinitialization=!1})(gdjs||(gdjs={}));
//# sourceMappingURL=CustomRuntimeObject.js.map
